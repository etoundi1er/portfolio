!function(){var t={},e=function(e){for(var n=t[e],r=n.deps,i=n.defn,a=r.length,c=new Array(a),u=0;a>u;++u)c[u]=o(r[u]);var l=i.apply(null,c);if(void 0===l)throw"module ["+e+"] returned undefined";n.instance=l},n=function(e,n,o){if("string"!=typeof e)throw"module id must be a string";if(void 0===n)throw"no dependencies for "+e;if(void 0===o)throw"no definition function for "+e;t[e]={deps:n,defn:o,instance:void 0}},o=function(n){var o=t[n];if(void 0===o)throw"module ["+n+"] was undefined";return void 0===o.instance&&e(n),o.instance},r=function(t,e){for(var n=t.length,r=new Array(n),i=0;n>i;++i)r.push(o(t[i]));e.apply(null,e)},i={};i.bolt={module:{api:{define:n,require:r,demand:o}}};var a=n,c=function(t,e){a(t,[],function(){return e})};c("1",tinymce.PluginManager),c("2",tinymce.Env),c("3",tinymce.util.Promise),c("4",tinymce.util.URI),c("5",tinymce.util.Tools),c("6",tinymce.util.Delay),a("j",[],function(){function t(t,e){return n(document.createElement("canvas"),t,e)}function e(t){return t.getContext("2d")}function n(t,e,n){return t.width=e,t.height=n,t}return{create:t,resize:n,get2dContext:e}}),a("k",[],function(){function t(t){return t.naturalWidth||t.width}function e(t){return t.naturalHeight||t.height}return{getWidth:t,getHeight:e}}),a("l",[],function(){function t(t,e){return function(){t.apply(e,arguments)}}function e(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],c(e,t(o,this),t(r,this))}function n(t){var e=this;return null===this._state?void this._deferreds.push(t):void u(function(){var n=e._state?t.onFulfilled:t.onRejected;if(null===n)return void(e._state?t.resolve:t.reject)(e._value);var o;try{o=n(e._value)}catch(r){return void t.reject(r)}t.resolve(o)})}function o(e){try{if(e===this)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var n=e.then;if("function"==typeof n)return void c(t(n,e),t(o,this),t(r,this))}this._state=!0,this._value=e,i.call(this)}catch(a){r.call(this,a)}}function r(t){this._state=!1,this._value=t,i.call(this)}function i(){for(var t=0,e=this._deferreds.length;e>t;t++)n.call(this,this._deferreds[t]);this._deferreds=null}function a(t,e,n,o){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.resolve=n,this.reject=o}function c(t,e,n){var o=!1;try{t(function(t){o||(o=!0,e(t))},function(t){o||(o=!0,n(t))})}catch(r){if(o)return;o=!0,n(r)}}if(window.Promise)return window.Promise;var u=e.immediateFn||"function"==typeof setImmediate&&setImmediate||function(t){setTimeout(t,1)},l=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};return e.prototype["catch"]=function(t){return this.then(null,t)},e.prototype.then=function(t,o){var r=this;return new e(function(e,i){n.call(r,new a(t,o,e,i))})},e.all=function(){var t=Array.prototype.slice.call(1===arguments.length&&l(arguments[0])?arguments[0]:arguments);return new e(function(e,n){function o(i,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var c=a.then;if("function"==typeof c)return void c.call(a,function(t){o(i,t)},n)}t[i]=a,0===--r&&e(t)}catch(u){n(u)}}if(0===t.length)return e([]);for(var r=t.length,i=0;i<t.length;i++)o(i,t[i])})},e.resolve=function(t){return t&&"object"==typeof t&&t.constructor===e?t:new e(function(e){e(t)})},e.reject=function(t){return new e(function(e,n){n(t)})},e.race=function(t){return new e(function(e,n){for(var o=0,r=t.length;r>o;o++)t[o].then(e,n)})},e}),a("m",[],function(){function t(t){var e=document.createElement("a");return e.href=t,e.pathname}function e(e){var n=t(e).split("."),o=n[n.length-1],r={jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png"};return o&&(o=o.toLowerCase()),r[o]}return{guessMimeType:e}}),a("c",["l","j","m","k"],function(t,e,n,o){function r(e){return new t(function(t){function n(){e.removeEventListener("load",n),t(e)}e.complete?t(e):e.addEventListener("load",n)})}function i(t){return r(t).then(function(t){var n,r;return r=e.create(o.getWidth(t),o.getHeight(t)),n=e.get2dContext(r),n.drawImage(t,0,0),r})}function a(t){return r(t).then(function(t){var e=t.src;return 0===e.indexOf("blob:")?u(e):0===e.indexOf("data:")?l(e):i(t).then(function(t){return l(t.toDataURL(n.guessMimeType(e)))})})}function c(e){return new t(function(t){function n(){o.removeEventListener("load",n),t(o)}var o=new Image;o.addEventListener("load",n),o.src=URL.createObjectURL(e),o.complete&&n()})}function u(e){return new t(function(t){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="blob",n.onload=function(){200==this.status&&t(this.response)},n.send()})}function l(e){return new t(function(t){var n,o,r,i,a,c;if(e=e.split(","),i=/data:([^;]+)/.exec(e[0]),i&&(a=i[1]),n=atob(e[1]),window.WebKitBlobBuilder){for(c=new WebKitBlobBuilder,o=new ArrayBuffer(n.length),r=0;r<o.length;r++)o[r]=n.charCodeAt(r);return c.append(o),void t(c.getBlob(a))}for(o=new Uint8Array(n.length),r=0;r<o.length;r++)o[r]=n.charCodeAt(r);t(new Blob([o],{type:a}))})}function s(t){return 0===t.indexOf("blob:")?u(t):0===t.indexOf("data:")?l(t):null}function f(t,e){return l(t.toDataURL(e))}function d(e){return new t(function(t){var n=new FileReader;n.onloadend=function(){t(n.result)},n.readAsDataURL(e)})}function h(t){return d(t).then(function(t){return t.split(",")[1]})}function p(t){URL.revokeObjectURL(t.src)}return{blobToImage:c,imageToBlob:a,blobToDataUri:d,blobToBase64:h,imageToCanvas:i,canvasToBlob:f,revokeImageUrl:p,uriToBlob:s}}),a("n",[],function(){function t(t,e,n){return t=parseFloat(t),t>n?t=n:e>t&&(t=e),t}function e(){return[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1]}function n(t,e){var n,o,r,i,a=[],c=new Array(10);for(n=0;5>n;n++){for(o=0;5>o;o++)a[o]=e[o+5*n];for(o=0;5>o;o++){for(i=0,r=0;5>r;r++)i+=t[o+5*r]*a[r];c[o+5*n]=i}}return c}function o(e,n){return n=t(n,0,1),e.map(function(e,o){return o%6===0?e=1-(1-e)*n:e*=n,t(e,0,1)})}function r(e,o){var r;return o=t(o,-1,1),o*=100,0>o?r=127+o/100*127:(r=o%1,r=0===r?f[o]:f[Math.floor(o)]*(1-r)+f[Math.floor(o)+1]*r,r=127*r+127),n(e,[r/127,0,0,0,.5*(127-r),0,r/127,0,0,.5*(127-r),0,0,r/127,0,.5*(127-r),0,0,0,1,0,0,0,0,0,1])}function i(e,o){var r,i,a,c;return o=t(o,-1,1),r=1+(o>0?3*o:o),i=.3086,a=.6094,c=.082,n(e,[i*(1-r)+r,a*(1-r),c*(1-r),0,0,i*(1-r),a*(1-r)+r,c*(1-r),0,0,i*(1-r),a*(1-r),c*(1-r)+r,0,0,0,0,0,1,0,0,0,0,0,1])}function a(e,o){var r,i,a,c,u;return o=t(o,-180,180)/180*Math.PI,r=Math.cos(o),i=Math.sin(o),a=.213,c=.715,u=.072,n(e,[a+r*(1-a)+i*-a,c+r*-c+i*-c,u+r*-u+i*(1-u),0,0,a+r*-a+.143*i,c+r*(1-c)+.14*i,u+r*-u+i*-.283,0,0,a+r*-a+i*-(1-a),c+r*-c+i*c,u+r*(1-u)+i*u,0,0,0,0,0,1,0,0,0,0,0,1])}function c(e,o){return o=t(255*o,-255,255),n(e,[1,0,0,0,o,0,1,0,0,o,0,0,1,0,o,0,0,0,1,0,0,0,0,0,1])}function u(e,o,r,i){return o=t(o,0,2),r=t(r,0,2),i=t(i,0,2),n(e,[o,0,0,0,0,0,r,0,0,0,0,0,i,0,0,0,0,0,1,0,0,0,0,0,1])}function l(e,r){return r=t(r,0,1),n(e,o([.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0,0,0,0,0,1],r))}function s(e,r){return r=t(r,0,1),n(e,o([.33,.34,.33,0,0,.33,.34,.33,0,0,.33,.34,.33,0,0,0,0,0,1,0,0,0,0,0,1],r))}var f=[0,.01,.02,.04,.05,.06,.07,.08,.1,.11,.12,.14,.15,.16,.17,.18,.2,.21,.22,.24,.25,.27,.28,.3,.32,.34,.36,.38,.4,.42,.44,.46,.48,.5,.53,.56,.59,.62,.65,.68,.71,.74,.77,.8,.83,.86,.89,.92,.95,.98,1,1.06,1.12,1.18,1.24,1.3,1.36,1.42,1.48,1.54,1.6,1.66,1.72,1.78,1.84,1.9,1.96,2,2.12,2.25,2.37,2.5,2.62,2.75,2.87,3,3.2,3.4,3.6,3.8,4,4.3,4.7,4.9,5,5.5,6,6.5,6.8,7,7.3,7.5,7.8,8,8.4,8.7,9,9.4,9.6,9.8,10];return{identity:e,adjust:o,multiply:n,adjustContrast:r,adjustBrightness:c,adjustSaturation:i,adjustHue:a,adjustColors:u,adjustSepia:l,adjustGrayscale:s}}),a("a",["j","k","c","n"],function(t,e,n,o){function r(o,r){return n.blobToImage(o).then(function(o){function i(t,e){var n,o,r,i,a,c=t.data,u=e[0],l=e[1],s=e[2],f=e[3],d=e[4],h=e[5],p=e[6],m=e[7],g=e[8],v=e[9],y=e[10],b=e[11],w=e[12],x=e[13],k=e[14],I=e[15],R=e[16],T=e[17],B=e[18],M=e[19];for(a=0;a<c.length;a+=4)n=c[a],o=c[a+1],r=c[a+2],i=c[a+3],c[a]=n*u+o*l+r*s+i*f+d,c[a+1]=n*h+o*p+r*m+i*g+v,c[a+2]=n*y+o*b+r*w+i*x+k,c[a+3]=n*I+o*R+r*T+i*B+M;return t}var a,c=t.create(e.getWidth(o),e.getHeight(o)),u=t.get2dContext(c);return u.drawImage(o,0,0),s(o),a=i(u.getImageData(0,0,c.width,c.height),r),u.putImageData(a,0,0),n.canvasToBlob(c)})}function i(o,r){return n.blobToImage(o).then(function(o){function i(t,e,n){function o(t,e,n){return t>n?t=n:e>t&&(t=e),t}var r,i,a,c,u,l,s,f,d,h,p,m,g,v,y,b,w;for(a=Math.round(Math.sqrt(n.length)),c=Math.floor(a/2),r=t.data,i=e.data,b=t.width,w=t.height,l=0;w>l;l++)for(u=0;b>u;u++){for(s=f=d=0,p=0;a>p;p++)for(h=0;a>h;h++)m=o(u+h-c,0,b-1),g=o(l+p-c,0,w-1),v=4*(g*b+m),y=n[p*a+h],s+=r[v]*y,f+=r[v+1]*y,d+=r[v+2]*y;v=4*(l*b+u),i[v]=o(s,0,255),i[v+1]=o(f,0,255),i[v+2]=o(d,0,255)}return e}var a,c,u=t.create(e.getWidth(o),e.getHeight(o)),l=t.get2dContext(u);return l.drawImage(o,0,0),s(o),a=l.getImageData(0,0,u.width,u.height),c=l.getImageData(0,0,u.width,u.height),c=i(a,c,r),l.putImageData(c,0,0),n.canvasToBlob(u)})}function a(o){return function(r,i){return n.blobToImage(r).then(function(r){function a(t,e){var n,o=t.data;for(n=0;n<o.length;n+=4)o[n]=e[o[n]],o[n+1]=e[o[n+1]],o[n+2]=e[o[n+2]];return t}var c,u,l=t.create(e.getWidth(r),e.getHeight(r)),f=t.get2dContext(l),d=new Array(256);for(u=0;u<d.length;u++)d[u]=o(u,i);return f.drawImage(r,0,0),s(r),c=a(f.getImageData(0,0,l.width,l.height),d),f.putImageData(c,0,0),n.canvasToBlob(l)})}}function c(t){return function(e,n){return r(e,t(o.identity(),n))}}function u(t){return function(e){return r(e,t)}}function l(t){return function(e){return i(e,t)}}var s=n.revokeImageUrl;return{invert:u([-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0]),brightness:c(o.adjustBrightness),hue:c(o.adjustHue),saturate:c(o.adjustSaturation),contrast:c(o.adjustContrast),grayscale:c(o.adjustGrayscale),sepia:c(o.adjustSepia),colorize:function(t,e,n,i){return r(t,o.adjustColors(o.identity(),e,n,i))},sharpen:l([0,-1,0,-1,5,-1,0,-1,0]),emboss:l([-2,-1,0,-1,1,1,0,1,2]),gamma:a(function(t,e){return 255*Math.pow(t/255,1-e)}),exposure:a(function(t,e){return 255*(1-Math.exp(-(t/255)*e))}),colorFilter:r,convoluteFilter:i}}),a("b",["c","j","k"],function(t,e,n){function o(o,r){return t.blobToImage(o).then(function(i){var a=e.create(n.getWidth(i),n.getHeight(i)),u=e.get2dContext(a),l=0,s=0;return r=0>r?360+r:r,90!=r&&270!=r||e.resize(a,a.height,a.width),90!=r&&180!=r||(l=a.width),270!=r&&180!=r||(s=a.height),u.translate(l,s),u.rotate(r*Math.PI/180),u.drawImage(i,0,0),c(i),t.canvasToBlob(a,o.type)})}function r(o,r){return t.blobToImage(o).then(function(o){var i=e.create(n.getWidth(o),n.getHeight(o)),a=e.get2dContext(i);return"v"==r?(a.scale(1,-1),a.drawImage(o,0,-i.height)):(a.scale(-1,1),a.drawImage(o,-i.width,0)),c(o),t.canvasToBlob(i)})}function i(n,o,r,i,a){return t.blobToImage(n).then(function(n){var u=e.create(i,a),l=e.get2dContext(u);return l.drawImage(n,-o,-r),c(n),t.canvasToBlob(u)})}function a(n,o,r){return t.blobToImage(n).then(function(i){var a=e.create(o,r),u=e.get2dContext(a);return u.drawImage(i,0,0,o,r),c(i),t.canvasToBlob(a,n.type)})}var c=t.revokeImageUrl;return{rotate:o,flip:r,crop:i,resize:a}}),a("7",["a","b"],function(t,e){var n=function(e){return t.invert(e)},o=function(e){return t.sharpen(e)},r=function(e){return t.emboss(e)},i=function(e,n){return t.gamma(e,n)},a=function(e,n){return t.exposure(e,n)},c=function(e,n,o,r){return t.colorize(e,n,o,r)},u=function(e,n){return t.brightness(e,n)},l=function(e,n){return t.hue(e,n)},s=function(e,n){return t.saturate(e,n)},f=function(e,n){return t.contrast(e,n)},d=function(e,n){return t.grayscale(e,n)},h=function(e,n){return t.sepia(e,n)},p=function(t,n){return e.flip(t,n)},m=function(t,n,o,r,i){return e.crop(t,n,o,r,i)},g=function(t,n,o){return e.resize(t,n,o)},v=function(t,n){return e.rotate(t,n)};return{invert:n,sharpen:o,emboss:r,brightness:u,hue:l,saturate:s,contrast:f,grayscale:d,sepia:h,colorize:c,gamma:i,exposure:a,flip:p,crop:m,resize:g,rotate:v}}),a("8",["c"],function(t){var e=function(e){return t.blobToImage(e)},n=function(e){return t.imageToBlob(e)},o=function(e){return t.blobToDataUri(e)},r=function(e){return t.blobToBase64(e)};return{blobToImage:e,imageToBlob:n,blobToDataUri:o,blobToBase64:r}}),c("d",tinymce.dom.DOMUtils),c("e",tinymce.ui.Factory),c("f",tinymce.ui.Form),c("g",tinymce.ui.Container),c("o",tinymce.ui.Control),c("p",tinymce.ui.DragHelper),c("q",tinymce.geom.Rect),c("s",tinymce.dom.DomQuery),c("t",tinymce.util.Observable),a("r",["s","p","q","5","t"],function(t,e,n,o,r){var i=0;return function(a,c,u,l){function s(t,e){return{x:e.x+t.x,y:e.y+t.y,w:e.w,h:e.h}}function f(t,e){return{x:e.x-t.x,y:e.y-t.y,w:e.w,h:e.h}}function d(){return f(u,a)}function h(){function r(t){var o;return new e(B,{document:l.ownerDocument,handle:B+"-"+t.name,start:function(){o=a},drag:function(e){var r,i,c,l,s;r=o.x,i=o.y,c=o.w,l=o.h,r+=e.deltaX*t.deltaX,i+=e.deltaY*t.deltaY,c+=e.deltaX*t.deltaW,l+=e.deltaY*t.deltaH,20>c&&(c=20),20>l&&(l=20),s=a=n.clamp({x:r,y:i,w:c,h:l},u,"move"==t.name),s=f(u,s),x.fire("updateRect",{rect:s}),y(s)}})}t('<div id="'+B+'" class="'+T+'croprect-container" data-mce-bogus="all">').appendTo(l),o.each(R,function(e){t("#"+B,l).append('<div id="'+B+"-"+e+'"class="'+T+'croprect-block" style="display: none" data-mce-bogus="all">')}),o.each(k,function(e){t("#"+B,l).append('<div id="'+B+"-"+e.name+'" class="'+T+"croprect-handle "+T+"croprect-handle-"+e.name+'" style="display: none" data-mce-bogus="all">')}),I=o.map(k,r),m(a)}function p(e){var n;n=o.map(k,function(t){return"#"+B+"-"+t.name}).concat(o.map(R,function(t){return"#"+B+"-"+t})).join(","),e?t(n,l).show():t(n,l).hide()}function m(e){function n(e,n){n.h<0&&(n.h=0),n.w<0&&(n.w=0),t("#"+B+"-"+e,l).css({left:n.x,top:n.y,width:n.w,height:n.h})}o.each(k,function(n){t("#"+B+"-"+n.name,l).css({left:e.w*n.xMul+e.x,top:e.h*n.yMul+e.y})}),n("top",{x:c.x,y:c.y,w:c.w,h:e.y-c.y}),n("right",{x:e.x+e.w,y:e.y,w:c.w-e.x-e.w+c.x,h:e.h}),n("bottom",{x:c.x,y:e.y+e.h,w:c.w,h:c.h-e.y-e.h+c.y}),n("left",{x:c.x,y:e.y,w:e.x-c.x,h:e.h}),n("move",e)}function g(t){a=t,m(a)}function v(t){c=t,m(a)}function y(t){g(s(u,t))}function b(t){u=t,m(a)}function w(){o.each(I,function(t){t.destroy()}),I=[]}var x,k,I,R,T="mce-",B=T+"crid-"+i++;return k=[{name:"move",xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:0,deltaH:0},{name:"nw",xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:-1,deltaH:-1},{name:"ne",xMul:1,yMul:0,deltaX:0,deltaY:1,deltaW:1,deltaH:-1},{name:"sw",xMul:0,yMul:1,deltaX:1,deltaY:0,deltaW:-1,deltaH:1},{name:"se",xMul:1,yMul:1,deltaX:0,deltaY:0,deltaW:1,deltaH:1}],R=["top","right","bottom","left"],h(l),x=o.extend({toggleVisibility:p,setClampRect:b,setRect:g,getInnerRect:d,setInnerRect:y,setViewPortRect:v,destroy:w},r)}}),a("h",["o","p","q","5","3","r"],function(t,e,n,o,r,i){function a(t){return new r(function(e){function n(){t.removeEventListener("load",n),e(t)}t.complete?e(t):t.addEventListener("load",n)})}return t.extend({Defaults:{classes:"imagepanel"},selection:function(t){return arguments.length?(this.state.set("rect",t),this):this.state.get("rect")},imageSize:function(){var t=this.state.get("viewRect");return{w:t.w,h:t.h}},toggleCropRect:function(t){this.state.set("cropEnabled",t)},imageSrc:function(t){var e=this,o=new Image;o.src=t,a(o).then(function(){var t,r,i=e.state.get("viewRect");r=e.$el.find("img"),r[0]?r.replaceWith(o):e.getEl().appendChild(o),t={x:0,y:0,w:o.naturalWidth,h:o.naturalHeight},e.state.set("viewRect",t),e.state.set("rect",n.inflate(t,-20,-20)),i&&i.w==t.w&&i.h==t.h||e.zoomFit(),e.repaintImage(),e.fire("load")})},zoom:function(t){return arguments.length?(this.state.set("zoom",t),this):this.state.get("zoom")},postRender:function(){return this.imageSrc(this.settings.imageSrc),this._super()},zoomFit:function(){var t,e,n,o,r,i,a,c=this;a=10,t=c.$el.find("img"),e=c.getEl().clientWidth,n=c.getEl().clientHeight,o=t[0].naturalWidth,r=t[0].naturalHeight,i=Math.min((e-a)/o,(n-a)/r),i>=1&&(i=1),c.zoom(i)},repaintImage:function(){var t,e,n,o,r,i,a,c,u,l;l=this.getEl(),c=this.zoom(),u=this.state.get("rect"),a=this.$el.find("img"),r=l.offsetWidth,i=l.offsetHeight,n=a[0].naturalWidth*c,o=a[0].naturalHeight*c,t=Math.max(0,r/2-n/2),e=Math.max(0,i/2-o/2),a.css({left:t,top:e,width:n,height:o}),this.cropRect&&(this.cropRect.setRect({x:u.x*c+t,y:u.y*c+e,w:u.w*c,h:u.h*c}),this.cropRect.setClampRect({x:t,y:e,w:n,h:o}),this.cropRect.setViewPortRect({x:0,y:0,w:r,h:i}))},bindStates:function(){function t(t){e.cropRect=new i(t,e.state.get("viewRect"),e.state.get("viewRect"),e.getEl()),e.cropRect.on("updateRect",function(t){var n=t.rect,o=e.zoom();n={x:Math.round(n.x/o),y:Math.round(n.y/o),w:Math.round(n.w/o),h:Math.round(n.h/o)},e.state.set("rect",n)}),e.on("remove",e.cropRect.destroy)}var e=this;e.state.on("change:cropEnabled",function(t){e.cropRect.toggleVisibility(t.value),e.repaintImage()}),e.state.on("change:zoom",function(){e.repaintImage()}),e.state.on("change:rect",function(n){var o=n.value;e.cropRect||t(o),e.cropRect.setRect(o)})}})}),a("i",[],function(){return function(){function t(t){var e;return e=i.splice(++a),i.push(t),{state:t,removed:e}}function e(){return o()?i[--a]:void 0}function n(){return r()?i[++a]:void 0}function o(){return a>0}function r(){return-1!=a&&a<i.length-1}var i=[],a=-1;return{data:i,add:t,undo:e,redo:n,canUndo:o,canRedo:r}}}),a("9",["d","5","3","e","f","g","h","7","8","i"],function(t,e,n,o,r,i,a,c,u,l){function s(t){return{blob:t,url:URL.createObjectURL(t)}}function f(t){t&&URL.revokeObjectURL(t.url)}function d(t){e.each(t,f)}function h(n,u,h){function p(t){var e,n,o,r;e=D.find("#w")[0],n=D.find("#h")[0],o=parseInt(e.value(),10),r=parseInt(n.value(),10),D.find("#constrain")[0].checked()&&at&&ct&&o&&r&&("w"==t.control.settings.name?(r=Math.round(o*ut),n.value(r)):(o=Math.round(r*lt),e.value(o))),at=o,ct=r}function m(t){return Math.round(100*t)+"%"}function g(){D.find("#undo").disabled(!st.canUndo()),D.find("#redo").disabled(!st.canRedo()),D.statusbar.find("#save").disabled(!st.canUndo())}function v(){D.find("#undo").disabled(!0),D.find("#redo").disabled(!0)}function y(t){t&&X.imageSrc(t.url)}function b(t){return function(){var n=e.grep(it,function(e){return e.settings.name!=t});e.each(n,function(t){t.hide()}),t.show()}}function w(t){O=s(t),y(O)}function x(t){n=s(t),y(n),d(st.add(n).removed),g()}function k(){var t=X.selection();c.crop(n.blob,t.x,t.y,t.w,t.h).then(function(t){x(t),T()})}function I(t){var e=[].slice.call(arguments,1);return function(){var o=O||n;t.apply(this,[o.blob].concat(e)).then(w)}}function R(t){var e=[].slice.call(arguments,1);return function(){t.apply(this,[n.blob].concat(e)).then(x)}}function T(){y(n),f(O),b(L)(),g()}function B(){O&&(x(O.blob),T())}function M(){var t=X.zoom();2>t&&(t+=.1),X.zoom(t)}function j(){var t=X.zoom();t>.1&&(t-=.1),X.zoom(t)}function C(){n=st.undo(),y(n),g()}function U(){n=st.redo(),y(n),g()}function z(){u(n.blob),D.close()}function H(t){return new r({layout:"flex",direction:"row",labelGap:5,border:"0 0 1 0",align:"center",pack:"center",padding:"0 10 0 10",spacing:5,flex:0,minHeight:60,defaults:{classes:"imagetool",type:"button"},items:t})}function A(t,e){return H([{text:"Back",onclick:T},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:B}]).hide().on("show",function(){v(),e(n.blob).then(function(t){var e=s(t);y(e),f(O),O=e})})}function E(t,e,o,r,i){function a(t){e(n.blob,t).then(function(t){var e=s(t);y(e),f(O),O=e})}return H([{text:"Back",onclick:T},{type:"spacer",flex:1},{type:"slider",flex:1,ondragend:function(t){a(t.value)},minValue:r,maxValue:i,value:o,previewFilter:m},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:B}]).hide().on("show",function(){this.find("slider").value(o),v()})}function _(t,e){function o(){var t,o,r;t=D.find("#r")[0].value(),o=D.find("#g")[0].value(),r=D.find("#b")[0].value(),e(n.blob,t,o,r).then(function(t){var e=s(t);y(e),f(O),O=e})}return H([{text:"Back",onclick:T},{type:"spacer",flex:1},{type:"slider",label:"R",name:"r",minValue:0,value:1,maxValue:2,ondragend:o,previewFilter:m},{type:"slider",label:"G",name:"g",minValue:0,value:1,maxValue:2,ondragend:o,previewFilter:m},{type:"slider",label:"B",name:"b",minValue:0,value:1,maxValue:2,ondragend:o,previewFilter:m},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:B}]).hide().on("show",function(){D.find("#r,#g,#b").value(1),v()})}function W(t){t.control.value()===!0&&(ut=ct/at,lt=at/ct)}var D,L,F,O,S,V,P,X,$,q,G,Y,K,N,Z,Q,J,tt,et,nt,ot,rt,it,at,ct,ut,lt,st=new l;S=H([{text:"Back",onclick:T},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:k}]).hide().on("show hide",function(t){X.toggleCropRect("show"==t.type)}).on("show",v),V=H([{text:"Back",onclick:T},{type:"spacer",flex:1},{type:"textbox",name:"w",label:"Width",size:4,onkeyup:p},{type:"textbox",name:"h",label:"Height",size:4,onkeyup:p},{type:"checkbox",name:"constrain",text:"Constrain proportions",checked:!0,onchange:W},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:"submit"}]).hide().on("submit",function(t){var e=parseInt(D.find("#w").value(),10),n=parseInt(D.find("#h").value(),10);t.preventDefault(),R(c.resize,e,n)(),T()}).on("show",v),P=H([{text:"Back",onclick:T},{type:"spacer",flex:1},{icon:"fliph",tooltip:"Flip horizontally",onclick:I(c.flip,"h")},{icon:"flipv",tooltip:"Flip vertically",onclick:I(c.flip,"v")},{icon:"rotateleft",tooltip:"Rotate counterclockwise",onclick:I(c.rotate,-90)},{icon:"rotateright",tooltip:"Rotate clockwise",onclick:I(c.rotate,90)},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:B}]).hide().on("show",v),G=A("Invert",c.invert),et=A("Sharpen",c.sharpen),nt=A("Emboss",c.emboss),Y=E("Brightness",c.brightness,0,-1,1),K=E("Hue",c.hue,180,0,360),N=E("Saturate",c.saturate,0,-1,1),Z=E("Contrast",c.contrast,0,-1,1),Q=E("Grayscale",c.grayscale,0,0,1),J=E("Sepia",c.sepia,0,0,1),tt=_("Colorize",c.colorize),ot=E("Gamma",c.gamma,0,-1,1),rt=E("Exposure",c.exposure,1,0,2),F=H([{text:"Back",onclick:T},{type:"spacer",flex:1},{text:"hue",icon:"hue",onclick:b(K)},{text:"saturate",icon:"saturate",onclick:b(N)},{text:"sepia",icon:"sepia",onclick:b(J)},{text:"emboss",icon:"emboss",onclick:b(nt)},{text:"exposure",icon:"exposure",onclick:b(rt)},{type:"spacer",flex:1}]).hide(),L=H([{tooltip:"Crop",icon:"crop",onclick:b(S)},{tooltip:"Resize",icon:"resize2",onclick:b(V)},{tooltip:"Orientation",icon:"orientation",onclick:b(P)},{tooltip:"Brightness",icon:"sun",onclick:b(Y)},{tooltip:"Sharpen",icon:"sharpen",onclick:b(et)},{tooltip:"Contrast",icon:"contrast",onclick:b(Z)},{tooltip:"Color levels",icon:"drop",onclick:b(tt)},{tooltip:"Gamma",icon:"gamma",onclick:b(ot)},{tooltip:"Invert",icon:"invert",onclick:b(G)}]),X=new a({flex:1,imageSrc:n.url}),$=new i({layout:"flex",direction:"column",border:"0 1 0 0",padding:5,spacing:5,items:[{type:"button",icon:"undo",tooltip:"Undo",name:"undo",onclick:C},{type:"button",icon:"redo",tooltip:"Redo",name:"redo",onclick:U},{type:"button",icon:"zoomin",tooltip:"Zoom in",onclick:M},{type:"button",icon:"zoomout",tooltip:"Zoom out",onclick:j}]}),q=new i({type:"container",layout:"flex",direction:"row",align:"stretch",flex:1,items:[$,X]}),it=[L,S,V,P,F,G,Y,K,N,Z,Q,J,tt,et,nt,ot,rt],D=o.create("window",{layout:"flex",direction:"column",align:"stretch",minWidth:Math.min(t.DOM.getViewPort().w,800),minHeight:Math.min(t.DOM.getViewPort().h,650),title:"Edit image",items:it.concat([q]),buttons:[{text:"Save",name:"save",subtype:"primary",onclick:z},{text:"Cancel",onclick:"close"}]}),D.renderTo(document.body).reflow(),D.on("close",function(){h(),d(st.data),st=null,O=null}),st.add(n),g(),X.on("load",function(){at=X.imageSize().w,ct=X.imageSize().h,ut=ct/at,lt=at/ct,D.find("#w").value(at),D.find("#h").value(ct)})}function p(t){return new n(function(e,n){h(s(t),e,n)})}return{edit:p}}),a("0",["1","2","3","4","5","6","7","8","9"],function(t,e,n,o,r,i,a,c,u){var l=function(t){function l(e){function n(t){return t.indexOf("px")==t.length-2}var o,r;return o=e.style.width,r=e.style.height,o||r?n(o)&&n(r)?{w:parseInt(o,10),h:parseInt(r,10)}:null:(o=t.$(e).attr("width"),r=t.$(e).attr("height"),o&&r?{w:parseInt(o,10),h:parseInt(r,10)}:null)}function s(e,n){var o,r;n&&(o=e.style.width,r=e.style.height,(o||r)&&t.$(e).css({width:n.w,height:n.h}).removeAttr("data-mce-style"),o=e.width,r=e.height,(o||r)&&t.$(e).attr({width:n.w,height:n.h}))}function f(t){return{w:t.naturalWidth,h:t.naturalHeight}}function d(){return t.selection.getNode()}function h(){return"imagetools"+A++}function p(e){var n=e.src;return 0===n.indexOf("data:")||0===n.indexOf("blob:")||new o(n).host===t.documentBaseURI.host}function m(e){return-1!==r.inArray(t.settings.imagetools_cors_hosts,new o(e.src).host)}function g(){return t.settings.api_key||t.settings.imagetools_api_key}function v(t){return new n(function(e){var n,o;n=new XMLHttpRequest,n.onload=function(){e(this.response)},n.open("GET",t,!0),o=g(),o&&(n.setRequestHeader("Content-Type","application/json;charset=UTF-8"),n.setRequestHeader("tiny-api-key",o)),n.responseType="blob",n.send()})}function y(e){var n=e.src;if(m(e))return v(e.src);if(!p(e)){if(n=t.settings.imagetools_proxy,n+=(-1===n.indexOf("?")?"?":"&")+"url="+encodeURIComponent(e.src),g())return v(n);e=new Image,e.src=n}return c.imageToBlob(e)}function b(){var e;return e=t.editorUpload.blobCache.getByUri(d().src),e?e:y(d()).then(function(e){return c.blobToBase64(e).then(function(n){var o=t.editorUpload.blobCache,r=o.create(h(),e,n);return o.add(r),r})})}function w(){z=i.setEditorTimeout(t,function(){t.editorUpload.uploadImagesAuto()},3e4)}function x(){clearTimeout(z)}function k(e,n){return c.blobToDataUri(e).then(function(r){var i,a,c,u,l;return l=d(),i=h(),c=t.editorUpload.blobCache,a=o.parseDataUri(r).data,u=c.create(i,e,a),c.add(u),t.undoManager.transact(function(){function e(){t.$(l).off("load",e),t.nodeChanged(),n?t.editorUpload.uploadImagesAuto():(x(),w())}t.$(l).on("load",e),t.$(l).attr({src:u.blobUri()}).removeAttr("data-mce-src")}),u})}function I(e){return function(){return t._scanForImages().then(b).then(e).then(k)}}function R(t){return function(){return I(function(e){var n=l(d());return n&&s(d(),{w:n.h,h:n.w}),a.rotate(e.blob(),t)})()}}function T(t){return function(){return I(function(e){return a.flip(e.blob(),t)})()}}function B(){var t=d(),e=f(t);t&&y(t).then(u.edit).then(function(o){return new n(function(n){c.blobToImage(o).then(function(r){var i=f(r);e.w==i.w&&e.h==i.h||l(t)&&s(t,i),URL.revokeObjectURL(r.src),n(o)})})}).then(function(t){k(t,!0)},function(){})}function M(){t.addButton("rotateleft",{title:"Rotate counterclockwise",onclick:R(-90)}),t.addButton("rotateright",{title:"Rotate clockwise",onclick:R(90)}),t.addButton("flipv",{title:"Flip vertically",onclick:T("v")}),t.addButton("fliph",{title:"Flip horizontally",onclick:T("h")}),t.addButton("editimage",{title:"Edit image",onclick:B}),t.addButton("imageoptions",{title:"Image options",icon:"options",cmd:"mceImage"})}function j(){t.on("NodeChange",function(e){H&&H.src!=e.element.src&&(x(),t.editorUpload.uploadImagesAuto(),H=void 0),C(e.element)&&(H=e.element)})}function C(e){var n=t.dom.is(e,"img:not([data-mce-object],[data-mce-placeholder])");return n&&(p(e)||m(e)||t.settings.imagetools_proxy)}function U(){var e=t.settings.imagetools_toolbar;e||(e="rotateleft rotateright | flipv fliph | crop editimage imageoptions"),t.addContextToolbar(C,e)}var z,H,A=0;e.fileApi&&(M(),U(),j(),t.addCommand("mceEditImage",B))};return t.add("imagetools",l),function(){}}),o("0")()}();